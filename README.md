# AI Crypto Advisor

A personalized cryptocurrency dashboard that provides real-time coin prices, market news, AI-generated insights, and crypto memes based on user preferences.

## Live Demo

[View Live Demo](https://ai-crypto-advisor-backend-7l8f.onrender.com/)

## Table of Contents

- [Live Demo](#live-demo)
- [Features](#features)
- [Tech Stack](#tech-stack)
- [Project Structure](#project-structure)
- [Prerequisites](#prerequisites)
- [Installation](#installation)
- [Environment Variables](#environment-variables)
- [Running the Application](#running-the-application)
- [API Endpoints](#api-endpoints)
- [Database Schema](#database-schema)
- [Caching Strategy](#caching-strategy)
- [Deployment](#deployment)

## Features

### User Features
- **User Authentication**: Secure login and signup with session management
- **Onboarding Flow**: Personalized preferences selection (crypto assets, investor type, content preferences)
- **Real-time Coin Prices**: Live cryptocurrency prices with 24-hour change indicators
- **Market News**: Curated crypto news filtered by user's selected assets
- **AI Insights**: Personalized daily insights generated by OpenAI based on user preferences
- **Crypto Memes**: Daily crypto-themed memes for entertainment
- **Feedback System**: Users can vote (thumbs up/down) on each dashboard section
- **Daily Content**: All content is cached daily

### Technical Features
- **MongoDB Caching**: Efficient daily caching system to reduce API calls
- **Date-based Voting**: User votes are tracked per section per day
- **Responsive Design**: Mobile-friendly interface
- **Error Handling**: Comprehensive error handling with user-friendly messages
- **Fallback Data**: Graceful degradation when external APIs fail

## Tech Stack

### Frontend
- **React 18** - UI library
- **Redux** - State management
- **React Router** - Client-side routing
- **Vite** - Build tool and dev server
- **Axios/Fetch** - HTTP client

### Backend
- **Node.js** - Runtime environment
- **Express.js** - Web framework
- **MongoDB** - Database
- **bcrypt** - Password hashing
- **cookie-parser** - Session management

### External APIs
- **CoinGecko API** - Cryptocurrency prices
- **CryptoPanic API** - Crypto news
- **OpenAI API** - AI-generated insights
- **Reddit API** - Crypto memes

## Project Structure

```
ai_crypto_advisor/
├── ai_crypto_advisor_backend/
│   ├── api/
│   │   ├── auth/              # Authentication routes & controllers
│   │   ├── user/              # User management
│   │   ├── news/              # Market news service
│   │   ├── ai-insight/        # AI insights service
│   │   ├── coin-prices/       # Cryptocurrency prices
│   │   ├── meme/              # Crypto memes
│   │   ├── feedback/          # User feedback/voting
│   │   └── daily-cache/       # Daily caching service
│   ├── services/
│   │   ├── db.service.js      # MongoDB connection
│   │   ├── logger.service.js  # Logging utility
│   │   └── als.service.js     # Async local storage
│   ├── middlewares/
│   │   ├── requireAuth.js     # Authentication middleware
│   │   └── setupAls.js        # ALS middleware
│   ├── server.js              # Main server file
│   └── package.json
│
└── ai_crypto_advisor_frontend/
    ├── src/
    │   ├── pages/
    │   │   ├── LoginPage.jsx      # Login/Signup page
    │   │   ├── OnboardingPage.jsx # User preferences setup
    │   │   └── Dashboard.jsx      # Main dashboard
    │   ├── cmps/
    │   │   ├── CoinPrices.jsx     # Coin prices component
    │   │   ├── MarketNews.jsx     # News component
    │   │   ├── AIInsight.jsx      # AI insights component
    │   │   ├── CryptoMeme.jsx     # Memes component
    │   │   └── VotingButtons.jsx  # Feedback buttons
    │   ├── services/
    │   │   ├── user.service.js    # User API calls
    │   │   ├── feedback.service.js # Feedback API calls
    │   │   └── event-bus.service.js # Event notifications
    │   ├── store/
    │   │   └── user/              # Redux user module
    │   ├── assets/
    │   │   └── style/             # CSS files
    │   ├── App.jsx
    │   └── main.jsx
    └── package.json
```

## Prerequisites

- **Node.js** (v16 or higher)
- **MongoDB** (v5 or higher)
- **npm** or **yarn**

## Installation

### 1. Clone the Repository

```bash
git clone <repository-url>
cd ai_crypto_advisor
```

### 2. Install Backend Dependencies

```bash
cd ai_crypto_advisor_backend
npm install
```

### 3. Install Frontend Dependencies

```bash
cd ../ai_crypto_advisor_frontend
npm install
```

## Environment Variables

### Backend (.env)

Create a `.env` file in the `ai_crypto_advisor_backend` directory:

```env
# Server Configuration
PORT=3030
NODE_ENV=development

# MongoDB
MONGODB_URI=mongodb://localhost:27017/crypto_advisor

# External APIs
CRYPTOPANIC_API_KEY=your_cryptopanic_api_key
OPENAI_API_KEY=your_openai_api_key
REDDIT_CLIENT_ID=your_reddit_client_id
REDDIT_CLIENT_SECRET=your_reddit_client_secret
```

### Frontend (.env)

Create a `.env` file in the `ai_crypto_advisor_frontend` directory:

```env
VITE_API_URL=http://localhost:3030
```

## Running the Application

### Development Mode

#### 1. Start MongoDB

```bash
# If using MongoDB locally
mongod
```

#### 2. Start Backend Server

```bash
cd ai_crypto_advisor_backend
npm run dev
```

The backend server will run on `http://localhost:3030`

#### 3. Start Frontend Development Server

```bash
cd ai_crypto_advisor_frontend
npm run dev
```

The frontend will run on `http://localhost:5173`

### Production Mode

#### 1. Build Frontend

```bash
cd ai_crypto_advisor_frontend
npm run build
```

#### 2. Copy Build to Backend

```bash
cp -r dist/* ../ai_crypto_advisor_backend/public/
```

#### 3. Start Backend

```bash
cd ../ai_crypto_advisor_backend
NODE_ENV=production npm start
```

The application will be available at `http://localhost:3030`

## Caching Strategy

### Daily Content Cache
- All dashboard content (news, AI insights, prices, memes) is cached in MongoDB per user
- Cache data remains in the database permanently (not deleted at midnight)
- **Cache Validation**: When a request comes in, the system checks if cached data exists from today (date >= midnight of current day)
- If cached data is found and the date matches today, it's returned immediately
- If no cached data exists or the date has passed (it's a new day), the system fetches fresh data from external APIs
- This approach reduces API calls to external services by ~95%
- Historical cache data is preserved for analytics and backup purposes

### How It Works
1. **Request arrives** for coin prices/news/insights
2. **Check database** for cached data where `userId` matches and `date >= today at 00:00:00`
3. **If found**: Return cached data (fast response)
4. **If not found or expired**: Fetch from external API, save to database with current timestamp, then return

### Feedback Cache
- User votes are stored per section per day
- Allows users to change their vote throughout the day
- Historical voting data preserved for analytics

### Database Collections
- `coinPrice`: Cached cryptocurrency prices per user
- `marketNews`: Cached news articles per user
- `cryptoMeme`: All fetched memes stored permanently
- `feedback`: User votes per section per day

### Database Indexes
- Compound index on `{userId: 1, date: 1}` for fast cache lookups

## Deployment

### Environment Setup

1. Set `NODE_ENV=production`
2. Configure production MongoDB URI
3. Set all required API keys
4. Update `VITE_API_URL` to production backend URL

### Build Process

```bash
# Build frontend
cd ai_crypto_advisor_frontend
npm run build

# Copy to backend public folder
cp -r dist/* ../ai_crypto_advisor_backend/public/

# Start production server
cd ../ai_crypto_advisor_backend
NODE_ENV=production npm start
```

## Features in Detail

### Onboarding Flow
- New users must complete preferences selection
- Validates that all fields are selected before submission
- Redirects to dashboard after successful onboarding

### Daily Refresh
- Content automatically refreshes when the date changes (after midnight)
- System checks cache validity by comparing cached date with current date
- If cached data is from a previous day, fresh data is fetched from APIs
- No manual refresh or cron jobs needed
- Consistent experience across all devices

### Feedback System
- Users can vote on each dashboard section
- Votes are tracked per day
- Visual active states for voted sections
- Prevents duplicate submissions with loading states

### Error Handling
- Graceful fallback to cached data if APIs fail
- User-friendly error messages
- Automatic retry mechanisms
- Fallback data for critical services

## API Rate Limits

- **CoinGecko**: 10-50 calls/minute (free tier)
- **CryptoPanic**: 100 calls/day (free tier)
- **OpenAI**: Based on your plan
- **Reddit**: 60 calls/minute

**Note:** Caching significantly reduces the number of API calls needed.

## Troubleshooting

### MongoDB Connection Issues
```bash
# Check if MongoDB is running
sudo systemctl status mongod

# Start MongoDB
sudo systemctl start mongod
```

### Port Already in Use
```bash
# Kill process on port 3030
lsof -ti:3030 | xargs kill -9
```

### API Key Issues
- Verify all API keys are set in `.env`
- Check API key validity and rate limits
- Review console logs for specific API errors

